{% extends 'base.html.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block body %}
    <div class="card">
        <div class="card-header">
            <b>
                {{ survey.name ~ ' (' ~ survey.datetime|date('Y-m-d') ~ ')' }}
            </b>
        </div>
    </div>
    {% if answers %}
        {% for questionNumber, questionValues in answers %}
            <div id="{{ 'container' ~ questionNumber }}" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
        {% endfor %}
    {% endif %}
{% endblock %}

{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"
    ></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script>
        $(function () {
            {% if answers %}
                {% for questionNumber, questionValues in answers %}
                    $('#container{{ questionNumber }}').highcharts({
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: '{{ questionNumber ~ '. ' ~ questionValues.question }}'
                        },
                        subtitle: {
                            text: 'Answers'
                        },
                        xAxis: {
                            categories: [
                                'Answers',
                            ]
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: 'Responders'
                            }
                        },
                        tooltip: {
                            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                                '<td style="padding:0"><b>{point.y}</b></td></tr>',
                            footerFormat: '</table>',
                            shared: true,
                            useHTML: true
                        },
                        plotOptions: {
                            column: {
                                pointPadding: 0.2,
                                borderWidth: 0
                            }
                        },
                        series: [
                            {% for optionId, optionValues in questionValues.options %}
                                {
                                    name: '{{ optionValues.value }}',
                                    data: [{{ optionValues.count }}]
                                },
                            {% endfor %}
                        ]
                    });
                {% endfor %}
            {% endif %}
        });
    </script>
{% endblock %}
